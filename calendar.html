<!-- ==================== FILE 2: calendar.html ==================== -->
<!-- Public Calendar View - Install hone ke baad yehi dikhega -->
<!-- Isko calendar.html ke naam se save karein -->

<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Ramadan Calendar - View</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #1a2e1a;
            padding: 20px;
        }
        .calendar-container {
            max-width: 500px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #1e4a2e, #0f3a1f);
            border-radius: 40px 8px 40px 8px;
            padding: 20px;
            margin-bottom: 25px;
            border: 3px solid #c9a75a;
            color: white;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5rem;
            color: #ffd966;
            font-family: 'Amiri', serif;
        }
        .install-badge {
            background: #4CAF50;
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            display: inline-block;
            font-weight: 600;
            margin-top: 10px;
        }
        .calendar-card {
            background: #faf3e2;
            border-radius: 50px 15px 50px 15px;
            padding: 25px;
            border: 3px solid #c9a75a;
            margin-bottom: 20px;
        }
        .profile-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 30px 8px 30px 8px;
            border: 2px solid #c9a75a;
        }
        .profile-image {
            width: 80px;
            height: 80px;
            background: #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 3px solid #c9a75a;
        }
        .profile-image i {
            font-size: 2.5rem;
            color: #888;
        }
        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-info {
            flex: 1;
        }
        .profile-info h2 {
            color: #1e4a2e;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        .profile-info p {
            color: #555;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        .ad-card {
            background: white;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #c9a75a;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .ad-icon {
            width: 50px;
            height: 50px;
            background: #1e4a2e;
            color: #ffd966;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .ad-content {
            flex: 1;
        }
        .ad-content h3 {
            color: #1e4a2e;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        .ad-link {
            display: inline-block;
            background: #1e4a2e;
            color: #ffd966;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        .ad-link i { margin-right: 5px; }
        .disabled-ad {
            opacity: 0.5;
        }
        .banner-card {
            background: linear-gradient(135deg, #1e4a2e, #0f3a1f);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #c9a75a;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .banner-icon {
            width: 50px;
            height: 50px;
            background: #ffd966;
            color: #1e4a2e;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .banner-content {
            flex: 1;
        }
        .banner-content h3 {
            color: #ffd966;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        .banner-link {
            color: #ffd966;
            text-decoration: underline;
            font-size: 0.9rem;
        }
        .date-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin: 20px 0;
        }
        .date-box {
            aspect-ratio: 1;
            background: white;
            border: 2px solid #c9a75a;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        .date-box .day {
            font-weight: bold;
            color: #1e4a2e;
        }
        .date-box .ramadan-day {
            color: #c9a75a;
            font-size: 0.7rem;
        }
        .footer {
            text-align: center;
            color: #faf3e2;
            margin-top: 20px;
            padding: 20px;
        }
        .no-data {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 30px;
            color: #666;
        }
        .back-btn {
            display: inline-block;
            margin-bottom: 20px;
            color: #ffd966;
            text-decoration: none;
            font-size: 0.9rem;
        }
        .back-btn i { margin-right: 5px; }
        @media (max-width: 480px) {
            .profile-section { flex-direction: column; text-align: center; }
            .ad-card { flex-direction: column; text-align: center; }
            .banner-card { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="calendar-container" id="calendarContainer">
        <!-- Dynamic content will load here -->
    </div>

    <script>
        // Check if running in standalone mode (installed)
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                             window.navigator.standalone || 
                             document.referrer.includes('android-app://');

        document.addEventListener('DOMContentLoaded', function() {
            loadCalendarData();
            
            // Agar installed mode ho to back button disable kar do
            if (isStandalone) {
                // History manipulation to prevent back to admin
                history.pushState(null, null, location.href);
                window.onpopstate = function () {
                    history.go(1);
                };
            }
        });

        function loadCalendarData() {
            const container = document.getElementById('calendarContainer');
            
            // Try to load data from multiple sources
            let data = null;
            
            // 1. Check localStorage
            const savedData = localStorage.getItem('ramadanBusinessData');
            if (savedData) {
                data = JSON.parse(savedData);
            }
            
            // 2. Check sessionStorage
            const sessionData = sessionStorage.getItem('currentCalendar');
            if (sessionData) {
                data = JSON.parse(sessionData);
            }
            
            // 3. Check URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            if (id) {
                const paramData = localStorage.getItem(id);
                if (paramData) {
                    data = JSON.parse(paramData);
                }
            }
            
            if (data) {
                renderCalendar(container, data);
            } else {
                // No data found - show empty state
                container.innerHTML = `
                    <div class="header">
                        <h1>ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† 1447</h1>
                        <p>Ú©ÛŒÙ„Ù†ÚˆØ±</p>
                    </div>
                    <div class="calendar-card">
                        <div class="no-data">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: #c9a75a; margin-bottom: 20px;"></i>
                            <h3>Ú©ÙˆØ¦ÛŒ ÚˆÛŒÙ¹Ø§ Ù†ÛÛŒÚº Ù…Ù„Ø§</h3>
                            <p style="margin: 20px 0;">Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾ÛÙ„Û’ Ø§ÛŒÚˆÙ…Ù† Ù¾ÛŒÙ†Ù„ Ø³Û’ ÚˆÛŒÙ¹Ø§ Ø³ÛŒÙ¹ Ú©Ø±ÛŒÚº</p>
                            ${!isStandalone ? '<a href="index.html" class="ad-link"><i class="fas fa-arrow-left"></i> Ø§ÛŒÚˆÙ…Ù† Ù¾ÛŒÙ†Ù„ Ù¾Ø± Ø¬Ø§Ø¦ÛŒÚº</a>' : ''}
                        </div>
                    </div>
                    <div class="footer">
                        <p>ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† Ù…Ø¨Ø§Ø±Ú© 1447Ú¾</p>
                    </div>
                `;
            }
        }

        function renderCalendar(container, data) {
            // Get profile picture
            const profilePic = localStorage.getItem('profilePic');
            
            // Generate Ramadan dates (1-30)
            const dates = [];
            for (let i = 1; i <= 30; i++) {
                dates.push(i);
            }
            
            // Split into weeks
            const weeks = [];
            for (let i = 0; i < dates.length; i += 7) {
                weeks.push(dates.slice(i, i + 7));
            }
            
            // Calculate iftar times (example times)
            const sehriTime = "4:30 AM";
            const iftarTime = "6:45 PM";
            
            let html = `
                <div class="header">
                    <h1>ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† 1447</h1>
                    <p>${data.businessName || 'Ramadan Calendar'}</p>
                    ${isStandalone ? '<div class="install-badge"><i class="fas fa-check-circle"></i> Ø§Ù†Ø³Ù¹Ø§Ù„ Ø´Ø¯Û</div>' : ''}
                </div>
                
                <!-- Business Profile -->
                <div class="profile-section">
                    <div class="profile-image">
                        ${profilePic ? 
                          `<img src="${profilePic}" alt="Profile">` : 
                          `<i class="fas ${data.profileIcon || 'fa-store'}"></i>`}
                    </div>
                    <div class="profile-info">
                        <h2>${data.businessName || 'Ú©Ø§Ø±ÙˆØ¨Ø§Ø± Ú©Ø§ Ù†Ø§Ù…'}</h2>
                        <p><i class="fas fa-phone"></i> ${data.phoneNumber || 'ÙÙˆÙ† Ù†Ù…Ø¨Ø±'}</p>
                        <p><i class="fas fa-map-marker-alt"></i> ${data.address || 'Ù¾ØªÛ'}</p>
                        <p><small>${data.businessDetails || ''}</small></p>
                    </div>
                </div>
            `;
            
            // Top Ads
            html += `<h3 style="color: #ffd966; margin: 20px 0 10px 0;">Ù¾Ø±ÙˆÙ…ÙˆØ´Ù†Ø²</h3>`;
            
            const ads = ['ad1', 'ad2', 'ad3'];
            let hasAds = false;
            
            ads.forEach(adId => {
                const ad = data[adId];
                if (ad && !ad.deleted && ad.text) {
                    hasAds = true;
                    html += `
                        <div class="ad-card ${!ad.clickable ? 'disabled-ad' : ''}">
                            <div class="ad-icon">
                                <i class="fas ${ad.icon || 'fa-gem'}"></i>
                            </div>
                            <div class="ad-content">
                                <h3>${ad.text}</h3>
                                ${ad.clickable ? 
                                    `<a href="${ad.link}" class="ad-link" target="_blank">
                                        <i class="fas fa-external-link-alt"></i> ØªÙØµÛŒÙ„Ø§Øª
                                    </a>` : 
                                    `<span style="color: #999;"><i class="fas fa-ban"></i> ÙÛŒ Ø§Ù„Ø­Ø§Ù„ ØºÛŒØ± ÙØ¹Ø§Ù„</span>`}
                            </div>
                        </div>
                    `;
                }
            });
            
            if (!hasAds) {
                html += `<p style="color: #999; text-align: center; margin: 20px;">Ú©ÙˆØ¦ÛŒ Ø§ÛŒÚˆØ² Ù†ÛÛŒÚº</p>`;
            }
            
            // Calendar Section
            html += `
                <div class="calendar-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #1e4a2e;">ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ú©</h2>
                        <div style="text-align: left;">
                            <p><i class="fas fa-clock"></i> Ø³Ø­Ø±ÛŒ: ${sehriTime}</p>
                            <p><i class="fas fa-clock"></i> Ø§ÙØ·Ø§Ø±: ${iftarTime}</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <p style="color: #1e4a2e; font-weight: 600;">Ø±ÙˆØ²Û’: 30</p>
                    </div>
            `;
            
            // Generate date grid
            weeks.forEach((week, weekIndex) => {
                html += '<div class="date-grid">';
                week.forEach(day => {
                    html += `
                        <div class="date-box">
                            <span class="day">${day}</span>
                            <span class="ramadan-day">Ø±Ù…Ø¶Ø§Ù†</span>
                        </div>
                    `;
                });
                html += '</div>';
            });
            
            html += `</div>`; // Close calendar-card
            
            // Bottom Banners
            const banners = ['banner1', 'banner2', 'banner3'];
            let hasBanners = false;
            
            banners.forEach(bannerId => {
                const banner = data[bannerId];
                if (banner && !banner.deleted && banner.text) {
                    hasBanners = true;
                    html += `
                        <div class="banner-card">
                            <div class="banner-icon">
                                <i class="fas ${banner.icon || 'fa-percent'}"></i>
                            </div>
                            <div class="banner-content">
                                <h3>${banner.text}</h3>
                                ${banner.clickable ? 
                                    `<a href="${banner.link}" class="banner-link" target="_blank">
                                        <i class="fas fa-external-link-alt"></i> Ù…Ø²ÛŒØ¯ Ø¬Ø§Ù†ÛŒÚº
                                    </a>` : 
                                    `<span style="color: #999;"><i class="fas fa-ban"></i> ÙÛŒ Ø§Ù„Ø­Ø§Ù„ ØºÛŒØ± ÙØ¹Ø§Ù„</span>`}
                            </div>
                        </div>
                    `;
                }
            });
            
            if (!hasBanners) {
                html += `<p style="color: #999; text-align: center; margin: 20px;">Ú©ÙˆØ¦ÛŒ Ø¨ÛŒÙ†Ø±Ø² Ù†ÛÛŒÚº</p>`;
            }
            
            // Footer
            html += `
                <div class="footer">
                    <p>ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† Ù…Ø¨Ø§Ø±Ú© 1447Ú¾</p>
                    <p style="font-size: 0.8rem; margin-top: 10px;">ØªÙ…Ø§Ù… Ø§ÙˆÙ‚Ø§ØªÙ Ù†Ù…Ø§Ø² Ù…Ù‚Ø§Ù…ÛŒ Ù…Ø³Ø¬Ø¯ Ú©Û’ Ù…Ø·Ø§Ø¨Ù‚</p>
                </div>
            `;
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>
